#include<Servo.h>
#include<IRremote.h>
Servo myservo1,myservo2;
int us_1_trig=A0,us_2_trig=A1,us_1_echo=4,us_2_echo=2;
int ir_1=6,ir_2=7,ir_3=8,ir_4=9;
int ir1v,ir2v,ir3v,ir4v;
int led1r=13,led2b=12,led3g=11,led4y=10;
long duration1,distance1,duration2,distance2;
int  dus=100,d1=500,d2=2000,d5=5000;
IRrecv irrecv1 (ir_1);
IRrecv irrecv2 (ir_2);
IRrecv irrecv3 (ir_3);
IRrecv irrecv4 (ir_4);
decode_results results;
void setup() 
{
// put your setup code here, to run once:
Serial.begin (9600);
  //for ultrasonic Sensors
pinMode(us_1_trig, OUTPUT);
pinMode(us_1_echo, INPUT);
pinMode(us_2_trig, OUTPUT);
pinMode(us_2_echo, INPUT);
  //for Servos
myservo1.attach(5);
myservo2.attach(3);
myservo1.write(0);
myservo2.write(0);
  //for IR sensor
  irrecv1.enableIRIn();
  irrecv2.enableIRIn();
  irrecv3.enableIRIn();
  irrecv4.enableIRIn();
  //for leds
  pinMode(led1r,OUTPUT);
  pinMode(led2b,OUTPUT);
  pinMode(led3g,OUTPUT);
  pinMode(led4y,OUTPUT);  
}
void loop()

{
// put your main code here, to run repeatedly:
//At ingate
digitalWrite(us_1_trig, LOW);
delayMicroseconds(100);
digitalWrite(us_1_trig, HIGH);
delayMicroseconds(100);
digitalWrite(us_1_trig, LOW);
duration1 = pulseIn(us_1_echo, HIGH);
distance1 = duration1/52.8;
Serial.println(distance1);
if(distance1 < 20)
{
myservo1.write(90);
delay(d2);
myservo1.write(0);
}
else myservo1.write(0);
delay(d5);
  


//At window 1
  for(int i=0;i<4;i++)
  {
   if (irrecv1.decode(&results)&&i==0)
   {
    Serial.println(results.value, HEX);
    if(results.value==0xFD30CF)ir1v=0;//by pressing 0 he don't want item 1
    if(results.value==0xFD08F7)ir1v=1;//by pressing 1 he ordered item 1
   }
  irrecv2.resume();
  delay(d1);
  if (irrecv2.decode(&results)&&i==1)
   {
    Serial.println(results.value, HEX);
    if(results.value==0xFD8877)ir2v=0;//by pressing 2 he don't want item 2
    if(results.value==0xFD48B7)ir2v=1;//by pressing 3 he ordered item 2
   }
  irrecv3.resume();
  delay(d1);
   if (irrecv3.decode(&results)&&i==2)
   {
    Serial.println(results.value, HEX);
    if(results.value==0xFD28D7)ir3v=0;//by pressing 4 he don't want item 3
    if(results.value==0xFDA857)ir3v=1;//by pressing 5 he ordered item 3
   }
  irrecv4.resume();
  delay(d1);
   if (irrecv4.decode(&results)&&i==3)
   {
    Serial.println(results.value, HEX);
     if(results.value==0xFD6897)ir4v=0;//by pressing 6 he don't want item 4
    if(results.value==0xFD18E7)ir4v=1;//by pressing 7 he ordered item 4
   }
  
  delay(d1); 
  }


//At Window 3
if(ir1v==1){digitalWrite(led1r,HIGH);}
if(ir2v==1){digitalWrite(led2b,HIGH);}
if(ir3v==1){digitalWrite(led3g,HIGH);}
if(ir4v==1){digitalWrite(led4y,HIGH);}
  delay(d2);
digitalWrite(led1r,LOW);
digitalWrite(led2b,LOW);
digitalWrite(led3g,LOW);
digitalWrite(led4y,LOW);


//At outgate
digitalWrite(us_2_trig, LOW);
delayMicroseconds(100);
digitalWrite(us_2_trig, HIGH);
delayMicroseconds(100);
digitalWrite(us_2_trig, LOW);
duration2 = pulseIn(us_2_echo, HIGH);
distance2 = duration2/52.8;
Serial.println(distance2);
if(distance2 < 30)
{
myservo2.write(90);
delay(d2);
myservo2.write(0);
}
else myservo2.write(0);
delay(d5);
} 
  